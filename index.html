<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ü‡ßÅ ‡¶Ü‡¶∞‡ßç‡¶® ‡¶™‡ßç‡¶∞‡ßã</title>
    <style>
        :root {
            --primary-color: #0a0f1f;
            --secondary-color: #1a2340;
            --accent-color: #00ffff;
            --accent-secondary-color: #ff00ff; /* ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ú‡ßá‡¶®‡ßç‡¶ü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∏‡ßá‡¶®‡ßç‡¶ü */
            --text-color: #e0e0e0;
            --success-color: #4caf50;
            --warning-color: #ffc107; /* ‡¶π‡¶≤‡ßÅ‡¶¶ */
            --danger-color: #f44336;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶´‡¶®‡ßç‡¶ü */
            --border-radius: 12px; /* ‡¶¨‡ßú ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß */
            --transition-speed: 0.3s;
            --shadow-light: rgba(0, 255, 255, 0.2);
            --shadow-dark: rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --primary-color: #e8eaf6;
            --secondary-color: #ffffff;
            --accent-color: #3f51b5; /* ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶ó‡ßã */
            --accent-secondary-color: #e91e63; /* ‡¶™‡¶ø‡¶ô‡ßç‡¶ï */
            --text-color: #212121;
            --shadow-light: rgba(63, 81, 181, 0.2);
            --shadow-dark: rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--primary-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .screen {
            display: none;
            flex-grow: 1;
            padding: 15px; /* ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶ü‡¶æ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
            overflow-y: auto;
            background-color: var(--secondary-color);
            animation: fadeIn var(--transition-speed) ease-out;
        }
        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .nav-bar {
            display: flex;
            justify-content: space-around;
            background-color: var(--primary-color);
            padding: 8px 0;
            border-top: 1px solid var(--accent-color);
            box-shadow: 0 -3px 15px var(--shadow-light);
            flex-shrink: 0; /* ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ ‡¶Ø‡ßá‡¶® ‡¶õ‡ßã‡¶ü ‡¶®‡¶æ ‡¶π‡ßü */
        }
        .nav-button {
            background: none; border: none; color: var(--text-color); font-size: 11px;
            padding: 6px 4px; cursor: pointer; transition: all var(--transition-speed);
            display: flex; flex-direction: column; align-items: center; gap: 3px;
            border-radius: var(--border-radius); flex: 1; /* ‡¶∏‡¶Æ‡¶æ‡¶®‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ ‡¶®‡ßá‡¶¨‡ßá */
        }
        .nav-button .icon { font-size: 18px; }
        .nav-button.active, .nav-button:hover {
            color: var(--accent-color);
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .button {
            background-image: linear-gradient(45deg, var(--accent-color), var(--accent-secondary-color));
            color: var(--primary-color); border: none; padding: 12px 22px;
            border-radius: var(--border-radius); font-size: 16px; font-weight: bold;
            cursor: pointer; transition: all var(--transition-speed);
            box-shadow: 0 4px 10px var(--shadow-light); text-transform: uppercase; letter-spacing: 1px;
        }
        .button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 15px var(--shadow-light);
        }
        .button:active { transform: translateY(0px) scale(0.97); }
        .button:disabled {
            background-image: none; background-color: #555; color: #888;
            cursor: not-allowed; box-shadow: none;
        }
        .button-secondary {
            background-image: none; background-color: var(--secondary-color);
            color: var(--accent-color); border: 1px solid var(--accent-color);
        }
        .button-secondary:hover { background-color: var(--primary-color); }

        h1, h2, h3 {
            font-weight: 600; /* ‡¶∏‡ßá‡¶Æ‡¶ø-‡¶¨‡ßã‡¶≤‡ßç‡¶° */
            color: var(--accent-color); margin-bottom: 18px; text-align: center;
        }
        h2 { font-size: 1.8em; }
        h3 { font-size: 1.2em; color: var(--text-color); text-align: left; }

        p { line-height: 1.7; margin-bottom: 12px; font-size: 0.95em; }

        .card {
            background-color: var(--primary-color); padding: 18px;
            border-radius: var(--border-radius); margin-bottom: 18px;
            box-shadow: 0 5px 15px var(--shadow-dark); width: 100%; max-width: 450px;
            border-left: 4px solid var(--accent-color);
        }

        .stat-display {
            font-size: 1.3em; margin: 12px 0; text-align: center;
            padding: 10px; background-color: var(--primary-color);
            border-radius: var(--border-radius);
            box-shadow: inset 0 0 10px var(--shadow-dark);
        }
        .stat-display .value { color: var(--warning-color); font-weight: bold; }

        /* --- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        #tapZoneScreen { justify-content: space-between; padding-bottom: 0; }
        .tap-area-container {
            flex-grow: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; width: 100%;
            position: relative; /* for advanced animations */
        }
        .tap-button-wrapper { position: relative; }
        .tap-button {
            width: 200px; height: 200px; border-radius: 50%;
            background: radial-gradient(circle, var(--accent-secondary-color) 0%, var(--accent-color) 100%);
            color: var(--primary-color); font-size: 28px; font-weight: bold;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            user-select: none; text-shadow: 0 0 5px rgba(0,0,0,0.3);
            box-shadow: 0 0 25px var(--accent-color), 0 0 35px var(--accent-color) inset, 0 8px 15px var(--shadow-dark);
            transition: transform 0.08s cubic-bezier(0.25, 0.1, 0.25, 1), box-shadow 0.08s;
            border: 6px solid var(--secondary-color);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        .tap-button:active {
            transform: scale(0.93) !important; /* Override pulse */
            box-shadow: 0 0 10px var(--accent-color), 0 0 15px var(--accent-color) inset, 0 4px 8px var(--shadow-dark);
            animation: none; /* Stop pulse on active */
        }
        #tapButtonFeedbackContainer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .floating-reward {
            position: absolute; font-size: 20px; font-weight: bold;
            color: var(--warning-color); opacity: 1;
            animation: floatUpBig 1.2s ease-out forwards;
            pointer-events: none; text-shadow: 1px 1px 2px var(--primary-color);
        }
        @keyframes floatUpBig {
            to { transform: translateY(-80px) scale(1.3); opacity: 0; }
        }
        .critical-flash {
            position: absolute; top: 50%; left: 50%; width: 300px; height: 300px;
            background-color: rgba(255, 255, 0, 0.5); border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: critFlash 0.5s ease-out; pointer-events: none;
        }
        @keyframes critFlash {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        .tap-stats { text-align: center; margin-top: 15px; width: 100%; }
        .tap-stats p { margin: 6px 0; font-size: 0.9em; }
        .combo-meter {
            width: 90%; max-width: 350px; height: 22px;
            background-color: var(--primary-color); border: 2px solid var(--accent-color);
            border-radius: var(--border-radius); margin: 10px auto; overflow: hidden;
            box-shadow: inset 0 0 8px var(--shadow-dark);
        }
        .combo-progress {
            height: 100%; width: 0%;
            background-image: linear-gradient(45deg, var(--success-color), #8bc34a);
            transition: width 0.15s linear;
        }
        #energyBarContainer { width: 70%; max-width: 250px; height: 15px; background-color: #333; border-radius: var(--border-radius); margin: 10px auto; overflow:hidden; border: 1px solid var(--accent-color);}
        #energyBar { height: 100%; width: 100%; background-color: var(--warning-color); transition: width 0.5s linear;}


        /* --- ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶ò‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        #shopItemsContainer .card { border-left-color: var(--accent-secondary-color); }

        /* --- ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡ßã‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        #profileZoneScreen .card { border-left-color: var(--success-color); }
        .profile-avatar {
            width: 120px; height: 120px; border-radius: 50%;
            background-image: linear-gradient(135deg, var(--accent-color), var(--accent-secondary-color));
            color: var(--primary-color); display: flex; justify-content: center; align-items: center;
            font-size: 50px; font-weight: bold; margin-bottom: 15px;
            box-shadow: 0 0 20px var(--shadow-light);
        }
        .username-input {
            background-color: var(--secondary-color); color: var(--text-color);
            border: 1px solid var(--accent-color); padding: 10px; width: calc(100% - 100px);
            border-radius: var(--border-radius); margin-right: 10px;
        }
        #badgesContainer span { margin: 0 3px; filter: drop-shadow(0 0 2px var(--accent-color)); }
        .stat-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95em; }
        .stat-item .label { color: #bbb; }
        .stat-item .value { color: var(--text-color); font-weight: 600; }


        /* --- ‡¶ó‡ßá‡¶Æ ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ú‡ßã‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .task-item { border-left-color: var(--warning-color); }
        .task-item.completed { border-left-color: var(--success-color); opacity: 0.8; background-color: #2c3e50cc; }
        .task-item h3 { font-size: 1.1em; }
        #taskHistoryList li { padding: 5px 0; border-bottom: 1px dashed var(--secondary-color); font-size: 0.9em;}
        #taskHistoryList li:last-child { border-bottom: none; }

        /* --- ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶ú‡ßã‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .rank-item { border: none; border-bottom: 1px solid var(--secondary-color); }
        .rank-item.user-rank {
            background-image: linear-gradient(to right, var(--accent-color) 0%, var(--primary-color) 70%) !important;
            color: var(--primary-color) !important;
            box-shadow: 0 0 15px var(--accent-color);
            border-radius: var(--border-radius);
        }
        .rank-item.user-rank .rank-position,
        .rank-item.user-rank .rank-name,
        .rank-item.user-rank .rank-score { color: var(--primary-color); text-shadow: 0 0 3px white;}
        .rank-position { font-size: 1.2em; }


        /* --- ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡ßã‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        #eventZoneScreen .card { border-left-color: var(--accent-secondary-color); }
        .event-item { text-align: center; }
        .event-item .button { margin-top: 10px; }
        .event-timer { font-size: 0.9em; color: var(--warning-color); }

        /* ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ */
        .loader { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }
        @keyframes spin { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }

        /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü */
        .alert-popup { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á, ‡¶∂‡ßÅ‡¶ß‡ßÅ font-weight: bold; ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® ... */
             font-weight: bold;
        }

        /* ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø */
        .confetti-container { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }
        .confetti { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }
        @keyframes fall { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶ó‡ßÅ‡¶≤‡ßã -->
        <div id="tapZoneScreen" class="screen">
            <div class="stat-display">üí∞ ‡¶Æ‡ßã‡¶ü ‡¶ï‡ßü‡ßá‡¶®: <span id="totalCoinsTap" class="value">0</span></div>
            <div id="timeBonusBarContainer" class="time-bonus-bar" style="display:none;">
                <div id="timeBonusProgress" class="time-bonus-progress"></div>
            </div>
            <p id="timeBonusMessage" style="display:none; color: var(--warning-color); font-weight:bold; text-align:center;"></p>
            
            <div class="tap-area-container">
                <div id="tapButtonWrapper" class="tap-button-wrapper">
                    <div id="tapButton" class="tap-button">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™!</div>
                    <div id="tapButtonFeedbackContainer"></div>
                </div>
            </div>

            <div class="tap-stats">
                <div id="energyBarContainer" style="display: none;">
                    <div id="energyBar"></div>
                </div>
                <p id="energyStat" style="display: none;">‚ö° ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø: <span id="energyValue">100</span>/<span id="maxEnergyValue">100</span></p>
                <p>üí• ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞: <span id="tapPowerStat">1</span></p>
                <p>üîó ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã: x<span id="comboMultiplierStat">1</span> (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö: <span id="maxComboStat">0</span>)</p>
                <div class="combo-meter"><div id="comboProgressBar" class="combo-progress"></div></div>
                <p id="comboBreakAlert" style="color: var(--danger-color); display: none; font-weight:bold;">‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶¨‡ßç‡¶∞‡ßá‡¶ï!</p>
                <p>üéØ ‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡¶æ‡¶®‡ßç‡¶∏: <span id="criticalChanceStat">5</span>% (x<span id="criticalMultiplierStat">3</span>)</p>
                <button id="activatePowerModeButton" class="button button-secondary" style="font-size:12px; padding: 8px 12px; margin-top:10px; display:none;">‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ( ‡¶§‡ßà‡ßü‡¶æ‡¶∞)</button>
            </div>
        </div>

        <div id="shopZoneScreen" class="screen">
            <h2>üè™ ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶ò‡¶∞</h2>
            <div class="stat-display">üí∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßü‡ßá‡¶®: <span id="totalCoinsShop" class="value">0</span></div>
            <button id="refreshShopButton" class="button button-secondary" style="margin-bottom: 15px;">‡¶∂‡¶™ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ (‡¶∏‡ßç‡¶™‡ßá‡¶∂‡¶æ‡¶≤ ‡¶Ö‡¶´‡¶æ‡¶∞?)</button>
            <div id="shopItemsContainer" style="width: 100%; max-width: 450px;"></div>
        </div>

        <div id="profileZoneScreen" class="screen">
            <h2>üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡ßã‡¶®</h2>
            <div class="profile-info card">
                <div id="profileAvatar" class="profile-avatar">AV</div>
                <h3 id="usernameDisplay" style="text-align:center; font-size:1.5em; margin-top:5px; margin-bottom:10px;">‡¶Ö‡¶§‡¶ø‡¶•‡¶ø</h3>
                <div class="stat-item"><span class="label">üèÜ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤:</span> <span id="profileLevel" class="value">1</span> (<span id="profileXP">0</span>/<span id="nextLevelXP">100</span> XP)</div>
                <div class="stat-item"><span class="label">üí∞ ‡¶Æ‡ßã‡¶ü ‡¶ï‡ßü‡ßá‡¶®:</span> <span id="profileTotalCoins" class="value">0</span></div>
                <div class="stat-item"><span class="label">üöÄ ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° (‡¶ï‡ßü‡ßá‡¶®):</span> <span id="profileHighScore" class="value">0</span></div>
                <div class="stat-item"><span class="label">üñê ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™:</span> <span id="profileTodayTaps" class="value">0</span></div>
                <div class="stat-item"><span class="label"> hist√≥rico ‡¶Æ‡ßã‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™:</span> <span id="profileTotalTaps" class="value">0</span></div>
                <div class="stat-item"><span class="label">üîó ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã:</span> <span id="profileMaxCombo" class="value">0</span></div>
                <div id="badgesContainer" style="text-align:center; margin-top:10px;"></div>
            </div>
            <div class="card">
                <h3>‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ì ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</h3>
                <input type="text" id="usernameInput" class="username-input" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡¶æ‡¶Æ (‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßß‡ß´ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞)">
                <button id="saveUsernameButton" class="button" style="padding:10px 15px; font-size:14px; width:80px;">‡¶∏‡ßá‡¶≠</button>
                <div style="margin-top:15px;">
                     <button id="themeToggleButton" class="button button-secondary theme-toggle" style="margin-right:10px;">‡¶•‡¶ø‡¶Æ</button>
                     <button id="soundToggleButton" class="button button-secondary">‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ‡¶Ö‡¶®</button>
                </div>
                <button id="resetProgressButton" class="button" style="background-image:none; background-color: var(--danger-color); margin-top:15px; width:100%;">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <div id="taskZoneScreen" class="screen">
            <h2>üéÆ ‡¶ó‡ßá‡¶Æ ‡¶Æ‡¶ø‡¶∂‡¶®</h2>
            <div id="tasksContainer" style="width: 100%; max-width: 450px;"></div>
            <div class="card" style="margin-top: 20px;">
                <h3>üìú ‡¶Æ‡¶ø‡¶∂‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                <ul id="taskHistoryList"></ul>
            </div>
        </div>

        <div id="rankZoneScreen" class="screen">
            <h2>üåç ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç (‡¶≤‡ßã‡¶ï‡¶æ‡¶≤)</h2>
            <p>‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶∏‡ßá‡¶∞‡¶æ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá‡•§</p>
            <div id="rankingFilterContainer" style="margin-bottom:15px; text-align:center;">
                <label for="rankingCategory">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</label>
                <select id="rankingCategory" class="username-input" style="width:auto; padding:8px;">
                    <option value="score">‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</option>
                    <option value="level">‡¶≤‡ßá‡¶≠‡ßá‡¶≤</option>
                    <option value="totalTaps">‡¶Æ‡ßã‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™</option>
                </select>
            </div>
            <div id="rankingListContainer" class="ranking-list" style="width: 100%; max-width: 450px;"></div>
            <button id="updateRankButton" class="button button-secondary" style="margin-top:20px;">‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</button>
        </div>
        
        <div id="eventZoneScreen" class="screen">
            <h2>üéâ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü</h2>
            <p>‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü‡ßá ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®!</p>
            <div id="eventItemsContainer" style="width: 100%; max-width: 450px;">
                <!-- ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶¨‡ßá -->
            </div>
        </div>
        
        <!-- ‡¶≤‡ßã‡¶°‡¶æ‡¶∞, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü, ‡¶ï‡¶®‡¶´‡ßá‡¶ü‡¶ø -->
        <div id="loader" class="loader"></div>
        <div id="alertPopup" class="alert-popup"></div>
        <div id="confettiContainer" class="confetti-container"></div>

        <!-- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ -->
        <nav class="nav-bar">
            <button class="nav-button active" data-screen="tapZoneScreen"><span class="icon">üñê</span><span class="nav-text">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™</span></button>
            <button class="nav-button" data-screen="shopZoneScreen"><span class="icon">üè™</span><span class="nav-text">‡¶¶‡ßã‡¶ï‡¶æ‡¶®</span></button>
            <button class="nav-button" data-screen="profileZoneScreen"><span class="icon">üë§</span><span class="nav-text">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></button>
            <button class="nav-button" data-screen="taskZoneScreen"><span class="icon">üéÆ</span><span class="nav-text">‡¶Æ‡¶ø‡¶∂‡¶®</span></button>
            <button class="nav-button" data-screen="rankZoneScreen"><span class="icon">üåç</span><span class="nav-text">‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç</span></button>
            <button class="nav-button" data-screen="eventZoneScreen"><span class="icon">üéâ</span><span class="nav-text">‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü</span></button>
        </nav>
    </div>
    
    <audio id="tapSound" preload="auto"></audio>
    <audio id="upgradeSound" preload="auto"></audio>
    <audio id="taskCompleteSound" preload="auto"></audio>
    <audio id="comboBreakSound" preload="auto"></audio>
    <audio id="levelUpSound" preload="auto"></audio>
    <audio id="criticalTapSound" preload="auto"></audio>

    <script>
    // --- ‡¶ó‡ßá‡¶Æ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ---
    let gameState = {
        coins: 0,
        tapPower: 1,
        autoTapPower: 0, // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶Ö‡¶ü‡ßã ‡¶Ü‡ßü
        username: '‡¶Ö‡¶§‡¶ø‡¶•‡¶ø',
        highScore: 0,
        todayTaps: 0,
        totalTaps: 0,
        lastPlayedDate: new Date().toISOString().slice(0,10),
        level: 1,
        xp: 0,
        theme: 'dark',
        soundEnabled: true,
        shopItems: {}, // ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶°‡ßá‡¶∞ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ { 'itemId': { level: 0, purchased: 0 } }
        completedTasks: [], // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá
        activeDailyTasks: {}, // { 'taskId': { completedToday: false, lastCompletionDate: '' } }
        
        // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞
        tapCombo: 0,
        maxCombo: 0,
        criticalTapChance: 0.05, // 5%
        criticalTapMultiplier: 3,
        baseTapMultiplier: 1, // ‡¶¨‡ßá‡¶∏ ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞, ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶™ ‡¶¶‡¶ø‡ßü‡ßá ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        
        comboTimeoutId: null,
        lastTapTime: 0,
        comboThreshold: 10, // ‡¶è‡¶á ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶ï ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶¨‡¶æ‡ßú‡ßá (‡¶è‡¶ñ‡¶® ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶á ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞)
        comboBreakGracePeriod: 2000, // ms, ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶∏‡¶Æ‡ßü

        timeBonus: {
            active: false,
            endsAt: 0,
            duration: 30000, // ms
            nextAvailableAt: 0,
            cooldown: 5 * 60 * 1000, // 5 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü
            multiplierEffect: 2,
        },
        
        energy: {
            current: 100,
            max: 100,
            rechargeRate: 1, // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá
            lastRechargeTime: Date.now(),
            enabled: false, // ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
        },
        
        powerMode: {
            active: false,
            endsAt: 0,
            duration: 10000, // 10 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
            cooldown: 60 * 1000, // 1 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü
            nextAvailableAt: 0,
            effectMultiplier: 3, // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡ß© ‡¶ó‡ßÅ‡¶£ ‡¶π‡¶¨‡ßá
        },

        // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ì ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø
        loginStreak: 0,
        lastLoginDate: '',
        gameStats: { // ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®
            totalGameTime: 0, // ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá
            tapSessions: 0,
            avgTapsPerSecond: 0,
            // ‡¶Ü‡¶∞‡¶ì ‡¶Ö‡¶®‡ßá‡¶ï ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü
        },
        
        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ
        eventData: {
            dailyLoginClaimedToday: false,
            wheelSpinsToday: 0,
            maxWheelSpinsPerDay: 1,
            // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ
        },
        currentLocalLeaderboard: [], // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂‡¶° ‡¶°‡ßá‡¶ü‡¶æ
    };

    const LEVEL_XP_THRESHOLD = [0, 100, 250, 500, 1000, 2000, 4000, 7500, 12000, 20000]; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü XP (‡¶ï‡ßç‡¶∞‡¶Æ‡¶¨‡¶∞‡ßç‡¶ß‡¶Æ‡¶æ‡¶®)

    // --- DOM ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π --- (‡¶Ö‡¶®‡ßá‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã, ‡¶§‡¶æ‡¶á ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶ï‡¶∞‡¶õ‡¶ø)
    const screens = document.querySelectorAll('.screen');
    const navButtons = document.querySelectorAll('.nav-button');
    const loader = document.getElementById('loader');
    const alertPopup = document.getElementById('alertPopup');

    // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶®
    const totalCoinsTapEl = document.getElementById('totalCoinsTap');
    const tapButton = document.getElementById('tapButton');
    const tapButtonFeedbackContainer = document.getElementById('tapButtonFeedbackContainer');
    const tapPowerStatEl = document.getElementById('tapPowerStat');
    const comboMultiplierStatEl = document.getElementById('comboMultiplierStat');
    const maxComboStatEl = document.getElementById('maxComboStat');
    const comboProgressBar = document.getElementById('comboProgressBar');
    const comboBreakAlertEl = document.getElementById('comboBreakAlert');
    const criticalChanceStatEl = document.getElementById('criticalChanceStat');
    const criticalMultiplierStatEl = document.getElementById('criticalMultiplierStat');
    const timeBonusBarContainer = document.getElementById('timeBonusBarContainer');
    const timeBonusProgress = document.getElementById('timeBonusProgress');
    const timeBonusMessageEl = document.getElementById('timeBonusMessage');
    const energyBarContainer = document.getElementById('energyBarContainer');
    const energyBar = document.getElementById('energyBar');
    const energyStatEl = document.getElementById('energyStat');
    const energyValueEl = document.getElementById('energyValue');
    const maxEnergyValueEl = document.getElementById('maxEnergyValue');
    const activatePowerModeButton = document.getElementById('activatePowerModeButton');


    // ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶ò‡¶∞
    const totalCoinsShopEl = document.getElementById('totalCoinsShop');
    const shopItemsContainer = document.getElementById('shopItemsContainer');
    const refreshShopButton = document.getElementById('refreshShopButton');

    // ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡ßã‡¶®
    const profileAvatarEl = document.getElementById('profileAvatar');
    const usernameDisplayEl = document.getElementById('usernameDisplay');
    const profileTotalCoinsEl = document.getElementById('profileTotalCoins');
    const profileHighScoreEl = document.getElementById('profileHighScore');
    const profileTodayTapsEl = document.getElementById('profileTodayTaps');
    const profileTotalTapsEl = document.getElementById('profileTotalTaps');
    const profileLevelEl = document.getElementById('profileLevel');
    const profileXPEl = document.getElementById('profileXP');
    const nextLevelXPEl = document.getElementById('nextLevelXP');
    const profileMaxComboEl = document.getElementById('profileMaxCombo');
    const badgesContainerEl = document.getElementById('badgesContainer');
    const usernameInput = document.getElementById('usernameInput');
    const saveUsernameButton = document.getElementById('saveUsernameButton');
    const themeToggleButton = document.getElementById('themeToggleButton');
    const soundToggleButton = document.getElementById('soundToggleButton');
    const resetProgressButton = document.getElementById('resetProgressButton');

    // ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ú‡ßã‡¶®
    const tasksContainer = document.getElementById('tasksContainer');
    const taskHistoryListEl = document.getElementById('taskHistoryList');
    const confettiContainer = document.getElementById('confettiContainer');

    // ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶ú‡ßã‡¶®
    const rankingListContainer = document.getElementById('rankingListContainer');
    const rankingCategorySelect = document.getElementById('rankingCategory');
    const updateRankButton = document.getElementById('updateRankButton');

    // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡ßã‡¶®
    const eventItemsContainer = document.getElementById('eventItemsContainer');
    
    // ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° (Data URL ‡¶è‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá ‡¶õ‡ßã‡¶ü, ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡¶∏‡¶Æ‡ßç‡¶Æ‡¶§ .wav ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã, ‡¶§‡¶¨‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá Placeholder ‡¶∞‡¶æ‡¶ñ‡¶õ‡¶ø)
    const sounds = {
        tap: document.getElementById('tapSound'),
        upgrade: document.getElementById('upgradeSound'),
        taskComplete: document.getElementById('taskCompleteSound'),
        comboBreak: document.getElementById('comboBreakSound'),
        levelUp: document.getElementById('levelUpSound'),
        criticalTap: document.getElementById('criticalTapSound'),
    };
    const soundFiles = { // Base64 encoded small wav files (example)
        tap: "data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=", // ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§, ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        upgrade: "data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YThAAAAKAExvb3AgV2F2AAA=", // ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶™ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        taskComplete: "data:audio/wav;base64,UklGRkIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAkAAAA", // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ö‡¶ø‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        comboBreak: "data:audio/wav;base64,UklGRjoAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YRIADgBEAFUAUwBUAFIAVQBDAFQARQA=", // ‡¶≠‡ßÅ‡¶≤ ‡¶¨‡¶æ ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        levelUp: "data:audio/wav;base64,UklGRkIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAkAAAA", // ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶Ü‡¶™ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
        criticalTap: "data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YThAAAAKAExvb3AgV2F2AAA=", // ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°
    };
    function loadSounds() {
        for (const key in sounds) {
            if (soundFiles[key]) sounds[key].src = soundFiles[key];
        }
    }
    function playSound(soundKey) {
        if (gameState.soundEnabled && sounds[soundKey]) {
            sounds[soundKey].currentTime = 0;
            sounds[soundKey].play().catch(e => {/* console.warn("‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶™‡ßç‡¶≤‡ßá‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e) */});
        }
    }
    soundToggleButton.addEventListener('click', () => {
        gameState.soundEnabled = !gameState.soundEnabled;
        soundToggleButton.textContent = `‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ${gameState.soundEnabled ? '‡¶Ö‡¶®' : '‡¶Ö‡¶´'}`;
        saveGame();
    });


    // --- ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function saveGame() {
        try {
            localStorage.setItem('tapProGameData', JSON.stringify(gameState));
        } catch (e) {
            console.error("‡¶ó‡ßá‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:", e);
            showTemporaryAlert("‡¶ó‡ßá‡¶Æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§", "danger");
        }
    }

    function loadGame() {
        showLoader();
        const savedData = localStorage.getItem('tapProGameData');
        if (savedData) {
            const loadedState = JSON.parse(savedData);
            // gameState ‡¶è‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã
            for (const key in loadedState) {
                if (gameState.hasOwnProperty(key)) {
                    if (typeof gameState[key] === 'object' && gameState[key] !== null && !Array.isArray(gameState[key])) {
                        // ‡¶®‡ßá‡¶∏‡ßç‡¶ü‡ßá‡¶° ‡¶Ö‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶™ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú (‡¶è‡¶ñ‡¶æ‡¶®‡ßá gameState.shopItems, timeBonus ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)
                        gameState[key] = { ...gameState[key], ...loadedState[key] };
                    } else {
                        gameState[key] = loadedState[key];
                    }
                } else { // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶°‡ßá‡¶ü‡¶æ‡ßü ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßÄ ‡¶•‡¶æ‡¶ï‡ßá ‡¶Ø‡¶æ ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü‡ßá ‡¶®‡ßá‡¶á
                    gameState[key] = loadedState[key];
                }
            }

            // ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
            const today = new Date().toISOString().slice(0,10);
            if (gameState.lastPlayedDate !== today) {
                gameState.todayTaps = 0;
                gameState.lastPlayedDate = today;
                // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
                Object.keys(gameState.activeDailyTasks).forEach(taskId => {
                    gameState.activeDailyTasks[taskId].completedToday = false;
                });
                // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
                gameState.eventData.dailyLoginClaimedToday = false;
                gameState.eventData.wheelSpinsToday = 0;

                // ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï
                const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0,10);
                if (gameState.lastLoginDate === yesterday) {
                    gameState.loginStreak++;
                } else {
                    gameState.loginStreak = 1; // ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ‡¶π‡¶≤‡ßá ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ
                }
                gameState.lastLoginDate = today;

            } else { // ‡¶è‡¶ï‡¶á ‡¶¶‡¶ø‡¶®‡ßá ‡¶ñ‡ßá‡¶≤‡¶≤‡ßá ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï ‡¶¨‡¶æ‡ßú‡ßá ‡¶®‡¶æ, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ lastLoginDate ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶π‡¶¨‡ßá
                 if (!gameState.lastLoginDate || gameState.lastLoginDate !== today) {
                    gameState.loginStreak = 1; // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞
                    gameState.lastLoginDate = today;
                 }
            }
        }
        
        // Initialize shopItems if they don't exist or miss properties
        SHOP_UPGRADES.forEach(upgrade => {
            if (!gameState.shopItems[upgrade.id]) {
                gameState.shopItems[upgrade.id] = { level: 0, purchased: 0 };
            } else { // Ensure all properties exist
                 gameState.shopItems[upgrade.id] = {
                    level: gameState.shopItems[upgrade.id].level || 0,
                    purchased: gameState.shopItems[upgrade.id].purchased || 0,
                 };
            }
        });
        
        // ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°-‡¶è‡¶∞ nextAvailableAt ‡¶ö‡ßá‡¶ï ‡¶ì ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        const now = Date.now();
        if (gameState.energy.enabled && gameState.energy.lastRechargeTime < now) {
            const timeDiffSeconds = Math.floor((now - gameState.energy.lastRechargeTime) / 1000);
            gameState.energy.current = Math.min(gameState.energy.max, gameState.energy.current + timeDiffSeconds * gameState.energy.rechargeRate);
            gameState.energy.lastRechargeTime = now;
        }
        if(gameState.powerMode.nextAvailableAt < now) gameState.powerMode.nextAvailableAt = 0; // Cooldown finished
        if(gameState.timeBonus.nextAvailableAt < now) gameState.timeBonus.nextAvailableAt = 0; // Cooldown finished


        applyTheme(gameState.theme);
        soundToggleButton.textContent = `‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ${gameState.soundEnabled ? '‡¶Ö‡¶®' : '‡¶Ö‡¶´'}`;
        updateAllUI();
        hideLoader();
    }
    
    function showLoader() { loader.style.display = 'block'; }
    function hideLoader() { loader.style.display = 'none'; }

    // --- UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function formatNumber(num) { // ‡¶¨‡ßú ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        num = Math.floor(num);
        if (num < 1000) return num.toLocaleString('bn-BD');
        const suffixes = ["", " ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞", " ‡¶≤‡¶ï‡ßç‡¶∑", " ‡¶ï‡ßã‡¶ü‡¶ø"];
        let i = 0;
        while (num >= 1000 && i < suffixes.length -1 ) {
            if (i < 1) num /= 1000; // ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞
            else num /= 100; // ‡¶≤‡¶ï‡ßç‡¶∑, ‡¶ï‡ßã‡¶ü‡¶ø
            i++;
        }
        return parseFloat(num.toFixed(1)).toLocaleString('bn-BD') + suffixes[i];
    }

    function updateCoinDisplay() {
        const formattedCoins = formatNumber(gameState.coins);
        if(totalCoinsTapEl) totalCoinsTapEl.textContent = formattedCoins;
        if(totalCoinsShopEl) totalCoinsShopEl.textContent = formattedCoins;
        if(profileTotalCoinsEl) profileTotalCoinsEl.textContent = formattedCoins;
    }

    function getCurrentTapMultiplier() {
        let multiplier = gameState.baseTapMultiplier;
        if (gameState.timeBonus.active) multiplier *= gameState.timeBonus.multiplierEffect;
        if (gameState.powerMode.active) multiplier *= gameState.powerMode.effectMultiplier;
        // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶∂‡¶™ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶•‡ßá‡¶ï‡ßá) ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        return multiplier;
    }

    function updateTapStats() {
        const currentTapMultiplier = getCurrentTapMultiplier();
        if(tapPowerStatEl) tapPowerStatEl.textContent = formatNumber(gameState.tapPower * currentTapMultiplier);
        if(comboMultiplierStatEl) comboMultiplierStatEl.textContent = `${gameState.tapCombo > 0 ? gameState.tapCombo : 1}`;
        if(maxComboStatEl) maxComboStatEl.textContent = formatNumber(gameState.maxCombo);
        if(comboProgressBar) comboProgressBar.style.width = `${Math.min(100, (gameState.tapCombo / (gameState.comboThreshold * 2)) * 100)}%`; // ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶•‡ßç‡¶∞‡ßá‡¶∂‡¶π‡ßã‡¶≤‡ßç‡¶°‡ßá‡¶∞ ‡¶¶‡ßç‡¶¨‡¶ø‡¶ó‡ßÅ‡¶£ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¨‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        if(criticalChanceStatEl) criticalChanceStatEl.textContent = `${(gameState.criticalTapChance * 100).toFixed(1)}`;
        if(criticalMultiplierStatEl) criticalMultiplierStatEl.textContent = `${gameState.criticalTapMultiplier}`;

        if(gameState.energy.enabled) {
            energyBarContainer.style.display = 'block';
            energyStatEl.style.display = 'block';
            energyValueEl.textContent = Math.floor(gameState.energy.current);
            maxEnergyValueEl.textContent = gameState.energy.max;
            energyBar.style.width = `${(gameState.energy.current / gameState.energy.max) * 100}%`;
        } else {
            energyBarContainer.style.display = 'none';
            energyStatEl.style.display = 'none';
        }

        if(activatePowerModeButton) {
            if (gameState.powerMode.nextAvailableAt === 0 && !gameState.powerMode.active) {
                activatePowerModeButton.style.display = 'inline-block';
                activatePowerModeButton.textContent = `‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° (${gameState.powerMode.duration/1000}s)`;
                activatePowerModeButton.disabled = false;
            } else if (gameState.powerMode.active) {
                activatePowerModeButton.style.display = 'inline-block';
                activatePowerModeButton.textContent = `‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º! ${Math.ceil((gameState.powerMode.endsAt - Date.now())/1000)}s`;
                activatePowerModeButton.disabled = true;
            } else { // Cooldown
                activatePowerModeButton.style.display = 'inline-block';
                activatePowerModeButton.textContent = `‡¶ï‡ßÅ‡¶≤‡¶°‡¶æ‡¶â‡¶® ${Math.ceil((gameState.powerMode.nextAvailableAt - Date.now())/1000)}s`;
                activatePowerModeButton.disabled = true;
            }
        }
    }
    
    function updateProfileInfo() {
        if(usernameDisplayEl) usernameDisplayEl.textContent = gameState.username;
        if(profileAvatarEl) profileAvatarEl.textContent = gameState.username.substring(0,2).toUpperCase() || 'üë§';
        if(profileHighScoreEl) profileHighScoreEl.textContent = formatNumber(gameState.highScore);
        if(profileTodayTapsEl) profileTodayTapsEl.textContent = formatNumber(gameState.todayTaps);
        if(profileTotalTapsEl) profileTotalTapsEl.textContent = formatNumber(gameState.totalTaps);
        if(profileLevelEl) profileLevelEl.textContent = gameState.level;
        if(profileXPEl) profileXPEl.textContent = formatNumber(gameState.xp);
        if(nextLevelXPEl) nextLevelXPEl.textContent = formatNumber(LEVEL_XP_THRESHOLD[gameState.level] || '‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö');
        if(profileMaxComboEl) profileMaxComboEl.textContent = formatNumber(gameState.maxCombo);
        renderBadges();
    }

    function updateAllUI() {
        updateCoinDisplay();
        updateTapStats();
        updateProfileInfo();
        renderShopItems();
        renderTasks();
        renderRankings();
        renderEvents();
    }

    // --- SPA ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ---
    function switchScreen(screenId) {
        screens.forEach(screen => screen.classList.remove('active'));
        navButtons.forEach(button => button.classList.remove('active'));
        document.getElementById(screenId)?.classList.add('active');
        document.querySelector(`.nav-button[data-screen="${screenId}"]`)?.classList.add('active');
        updateAllUI(); // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
    }
    navButtons.forEach(button => {
        button.addEventListener('click', () => switchScreen(button.dataset.screen));
    });

    // --- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    tapButton.addEventListener('mousedown', (event) => { // click ‡¶è‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá mousedown ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡ßü
        if (event.button === 0) { // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶æ‡¶Æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï
            handleTap(event);
        }
    });
    tapButton.addEventListener('touchstart', (event) => {
        event.preventDefault();
        handleTap(event.touches[0]);
    }, { passive: false });

    function handleTap(event) {
        if (gameState.energy.enabled && gameState.energy.current < 1) {
            showTemporaryAlert("‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø!", "warning");
            return;
        }
        if (gameState.energy.enabled) {
            gameState.energy.current -= 1; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡ßß ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶ñ‡¶∞‡¶ö
        }

        playSound('tap');
        const tapMultiplier = getCurrentTapMultiplier();
        let rewardAmount = gameState.tapPower * tapMultiplier * (gameState.tapCombo > 0 ? gameState.tapCombo : 1);
        let isCritical = false;

        if (Math.random() < gameState.criticalTapChance) {
            rewardAmount *= gameState.criticalTapMultiplier;
            isCritical = true;
            playSound('criticalTap');
            // ‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≠‡¶ø‡¶ú‡ßç‡¶Ø‡ßÅ‡ßü‡¶æ‡¶≤ ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï
            const flash = document.createElement('div');
            flash.className = 'critical-flash';
            tapButtonWrapper.appendChild(flash);
            setTimeout(() => flash.remove(), 500);
        }
        
        gameState.coins += rewardAmount;
        gameState.todayTaps++;
        gameState.totalTaps++;
        gameState.highScore = Math.max(gameState.highScore, gameState.coins);
        addXP(1 + Math.floor(gameState.tapCombo / 10)); // ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ XP

        // ‡¶´‡ßç‡¶≤‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
        const rewardEl = document.createElement('div');
        rewardEl.className = 'floating-reward';
        rewardEl.textContent = `+${formatNumber(rewardAmount)}` + (isCritical ? ' üî•' : '');
        if(isCritical) rewardEl.style.color = 'var(--danger-color)';
        
        const rect = tapButton.getBoundingClientRect();
        const x = (event.clientX ? (event.clientX - rect.left) : (rect.width / 2)) + (Math.random()*40-20); // ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶Æ ‡¶™‡¶ú‡¶ø‡¶∂‡¶®
        const y = (event.clientY ? (event.clientY - rect.top) : (rect.height / 2)) + (Math.random()*20-10);
        rewardEl.style.left = `${Math.max(0, Math.min(rect.width - 30, x - 15))}px`;
        rewardEl.style.top = `${Math.max(0, Math.min(rect.height - 20, y - 10))}px`;
        tapButtonFeedbackContainer.appendChild(rewardEl);
        setTimeout(() => rewardEl.remove(), 1200);

        // ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶≤‡¶ú‡¶ø‡¶ï
        const now = Date.now();
        if (gameState.lastTapTime && (now - gameState.lastTapTime < gameState.comboBreakGracePeriod)) {
            gameState.tapCombo++;
            gameState.maxCombo = Math.max(gameState.maxCombo, gameState.tapCombo);
            // ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶•‡ßç‡¶∞‡ßá‡¶∂‡¶π‡ßã‡¶≤‡ßç‡¶°‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ï‡¶ø‡¶õ‡ßÅ (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶¨‡¶æ ‡¶õ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®)
            if (gameState.tapCombo > 0 && gameState.tapCombo % gameState.comboThreshold === 0) {
                // showTemporaryAlert(`${gameState.tapCombo} ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã!`, 'info', 800);
                // ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
            }
        } else {
            if (gameState.tapCombo > 3) { // ‡ß© ‡¶è‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶π‡¶≤‡ßá ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü
                comboBreakAlertEl.style.display = 'block';
                playSound('comboBreak');
                setTimeout(() => comboBreakAlertEl.style.display = 'none', 1500);
            }
            gameState.tapCombo = 1; // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶¨‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ
        }
        gameState.lastTapTime = now;
        
        clearTimeout(gameState.comboTimeoutId);
        gameState.comboTimeoutId = setTimeout(() => {
            if (Date.now() - gameState.lastTapTime >= gameState.comboBreakGracePeriod && gameState.tapCombo > 0) {
                 if (gameState.tapCombo > 3) comboBreakAlertEl.style.display = 'block';
                 playSound('comboBreak');
                 setTimeout(() => comboBreakAlertEl.style.display = 'none', 1500);
                 gameState.tapCombo = 0;
                 updateTapStats();
            }
        }, gameState.comboBreakGracePeriod);

        updateCoinDisplay();
        updateTapStats();
        saveGame();
        checkAllTasksCompletion();
    }
    
    // ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶ü
    activatePowerModeButton.addEventListener('click', () => {
        if (gameState.powerMode.nextAvailableAt === 0 && !gameState.powerMode.active) {
            gameState.powerMode.active = true;
            gameState.powerMode.endsAt = Date.now() + gameState.powerMode.duration;
            gameState.powerMode.nextAvailableAt = gameState.powerMode.endsAt + gameState.powerMode.cooldown;
            showTemporaryAlert(`‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° (${gameState.powerMode.duration/1000}s) ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º! ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ x${gameState.powerMode.effectMultiplier}!`, 'success');
            updateTapStats();
        }
    });

    // --- ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ì ‡¶Ö‡¶ü‡ßã ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶ó‡ßá‡¶Æ ‡¶≤‡ßÅ‡¶™‡ßá) ---
    function gameLoop() {
        const now = Date.now();

        // ‡¶Ö‡¶ü‡ßã ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™
        if (gameState.autoTapPower > 0) {
            const autoTapReward = gameState.autoTapPower * getCurrentTapMultiplier(); // ‡¶Ö‡¶ü‡ßã ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡¶ì ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá
            gameState.coins += autoTapReward / (1000 / GAME_LOOP_INTERVAL); // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡ßÅ‡¶™‡ßá ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶Ö‡¶Ç‡¶∂
            if(document.getElementById('tapZoneScreen').classList.contains('active')) updateCoinDisplay(); // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡ßü‡ßá‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        }

        // ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ì ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
        if (gameState.timeBonus.active && now >= gameState.timeBonus.endsAt) {
            gameState.timeBonus.active = false;
            timeBonusBarContainer.style.display = 'none';
            timeBonusMessageEl.style.display = 'none';
            gameState.timeBonus.nextAvailableAt = now + gameState.timeBonus.cooldown;
            updateTapStats();
            showTemporaryAlert('‡¶∏‡¶Æ‡ßü ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∂‡ßá‡¶∑!', 'info');
        } else if (gameState.timeBonus.active) {
            const timeLeft = gameState.timeBonus.endsAt - now;
            timeBonusProgress.style.width = `${(timeLeft / gameState.timeBonus.duration) * 100}%`;
        }
        // ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø (‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶∂‡¶™ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá)
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶® ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã, ‡¶Ø‡¶æ ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡ßã‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá
        // if (!gameState.timeBonus.active && now >= gameState.timeBonus.nextAvailableAt) {
        //     activateTimeBonus(); // ‡¶è‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
        // }


        // ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú
        if (gameState.energy.enabled && gameState.energy.current < gameState.energy.max) {
            const timeDiffSeconds = (now - gameState.energy.lastRechargeTime) / 1000;
            if (timeDiffSeconds >= 1) { // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú
                gameState.energy.current = Math.min(gameState.energy.max, gameState.energy.current + Math.floor(timeDiffSeconds) * gameState.energy.rechargeRate);
                gameState.energy.lastRechargeTime = now;
                if(document.getElementById('tapZoneScreen').classList.contains('active')) updateTapStats();
            }
        }
        
        // ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ‡¶ö‡ßá‡¶ï
        if (gameState.powerMode.active && now >= gameState.powerMode.endsAt) {
            gameState.powerMode.active = false;
            showTemporaryAlert('‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ‡¶∂‡ßá‡¶∑!', 'info');
            updateTapStats();
        }
        if (!gameState.powerMode.active && gameState.powerMode.nextAvailableAt > 0 && now >= gameState.powerMode.nextAvailableAt) {
            gameState.powerMode.nextAvailableAt = 0; // Cooldown finished
            updateTapStats(); // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        }


        // ‡¶ó‡ßá‡¶Æ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ó‡¶£‡¶®‡¶æ
        gameState.gameStats.totalGameTime += GAME_LOOP_INTERVAL / 1000;

        saveGame(); // ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶∏‡ßá‡¶≠
    }
    const GAME_LOOP_INTERVAL = 200; // ms (5 times per second) - ‡¶ò‡¶® ‡¶ò‡¶® ‡¶∏‡ßá‡¶≠ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡¶á ‡¶≠‡¶æ‡¶≤‡ßã
    setInterval(gameLoop, GAME_LOOP_INTERVAL);
    // ‡¶ò‡¶® ‡¶ò‡¶® ‡¶∏‡ßá‡¶≠‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡¶Æ‡ßü ‡¶™‡¶∞ ‡¶¨‡¶æ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã
    // setInterval(saveGame, 30000); // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß©‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∏‡ßá‡¶≠

    function activateTimeBonus() { // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá)
        if (gameState.timeBonus.active || Date.now() < gameState.timeBonus.nextAvailableAt) {
             showTemporaryAlert(`‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶è‡¶ñ‡¶® –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω‡•§ ${Math.ceil((gameState.timeBonus.nextAvailableAt - Date.now())/1000)}s ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, "warning");
            return;
        }
        gameState.timeBonus.active = true;
        gameState.timeBonus.endsAt = Date.now() + gameState.timeBonus.duration;
        
        timeBonusBarContainer.style.display = 'block';
        timeBonusMessageEl.textContent = `‡¶∏‡¶Æ‡ßü ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º! ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ x${gameState.timeBonus.multiplierEffect}!`;
        timeBonusMessageEl.style.display = 'block';
        showTemporaryAlert('‡¶∏‡¶Æ‡ßü ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∂‡ßÅ‡¶∞‡ßÅ!', 'success');
        updateTapStats();
    }


    // --- ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶ò‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ---
    // priceMultiplier: 1.15 ‡¶Æ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá ‡¶¶‡¶æ‡¶Æ ‡ßß‡ß´% ‡¶¨‡¶æ‡ßú‡ßá
    const SHOP_UPGRADES = [
        // ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶®
        { id: 'tapPower', name: 'üëÜ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞', description: '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶ï‡ßü‡ßá‡¶®‡•§', basePrice: 10, priceMultiplier: 1.15, maxLevel: 100, type: 'tap', effect: (level) => gameState.tapPower = 1 + level * (1 + Math.floor(level/10)) }, // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü ‡¶¨‡ßá‡¶∂‡¶ø
        { id: 'criticalChance', name: 'üéØ ‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ö‡¶æ‡¶®‡ßç‡¶∏', description: '‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶π‡¶ø‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶æ‡¶¨‡¶®‡¶æ ‡ß¶.‡ßß% ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 150, priceMultiplier: 1.25, maxLevel: 50, type: 'tap', effect: (level) => gameState.criticalTapChance = 0.05 + (level * 0.001) },
        { id: 'criticalMultiplier', name: 'üí• ‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞', description: '‡¶ï‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶π‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ó‡ßÅ‡¶£‡¶ï ‡ß¶.‡ßß ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 300, priceMultiplier: 1.3, maxLevel: 30, type: 'tap', effect: (level) => gameState.criticalTapMultiplier = 3 + (level * 0.1) },
        { id: 'comboBoost', name: 'üîó ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶™‡¶ø‡¶∞‡¶ø‡ßü‡¶°', description: '‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡ß¶.‡ß¶‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 200, priceMultiplier: 1.2, maxLevel: 20, type: 'tap', effect: (level) => gameState.comboBreakGracePeriod = 2000 + (level * 50)},
        
        // ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶∂‡¶® ‡¶ì ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø
        { id: 'autoTap', name: 'ü§ñ ‡¶Ö‡¶ü‡ßã ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™', description: '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡ß¶.‡ß´ ‡¶ï‡ßü‡ßá‡¶® ‡¶Ü‡ßü (‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ó‡ßÅ‡¶£‡¶ø‡¶§‡¶ï ‡¶®‡ßü)‡•§', basePrice: 500, priceMultiplier: 1.4, maxLevel: 50, type: 'automation', effect: (level) => gameState.autoTapPower = level * 0.5 },
        { id: 'offlineEarnings', name: 'üò¥ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Ü‡ßü', description: '‡¶Ö‡¶´ ‡¶•‡¶æ‡¶ï‡¶æ‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡¶Ü‡ßü‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ ‡¶¨‡¶æ‡ßú‡¶æ‡¶® (‡¶Ö‡¶ü‡ßã-‡¶ü‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ % ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá)‡•§', basePrice: 1000, priceMultiplier: 1.5, maxLevel: 20, type: 'automation', effect: (level) => { /* gameState.offlineEarningMultiplier = level * 0.05 */ }}, // ‡¶è‡¶á ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ Íµ¨ÌòÑ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
        { id: 'maxEnergy', name: '‚ö° ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø', description: '‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡ßß‡ß¶ ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 100, priceMultiplier: 1.2, maxLevel: 20, type: 'energy', condition: () => gameState.energy.enabled, effect: (level) => gameState.energy.max = 100 + level * 10 },
        { id: 'energyRecharge', name: 'üîã ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú', description: '‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡ß¶.‡ß® ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 250, priceMultiplier: 1.3, maxLevel: 15, type: 'energy', condition: () => gameState.energy.enabled, effect: (level) => gameState.energy.rechargeRate = 1 + level * 0.2 },
        { id: 'enableEnergySystem', name: 'üí° ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ', description: '‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶ó‡ßá‡¶Æ ‡¶Ü‡¶∞‡¶ì ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú‡¶ø‡¶Ç ‡¶π‡¶¨‡ßá)‡•§', basePrice: 5000, priceMultiplier: 1, maxLevel: 1, type: 'special', effect: (level) => gameState.energy.enabled = (level > 0) },

        // ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ì ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶™
        { id: 'timeBonusDuration', name: '‚è±Ô∏è ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤', description: '‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 400, priceMultiplier: 1.25, maxLevel: 10, type: 'bonus', effect: (level) => gameState.timeBonus.duration = 30000 + level * 5000 },
        { id: 'powerModeDuration', name: 'üöÄ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶° ‡¶∏‡¶Æ‡ßü‡¶ï‡¶æ‡¶≤', description: '‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡ß® ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡•§', basePrice: 600, priceMultiplier: 1.3, maxLevel: 10, type: 'bonus', effect: (level) => gameState.powerMode.duration = 10000 + level * 2000 },
        { id: 'xpBoost', name: 'üåü ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶ø ‡¶¨‡ßÅ‡¶∏‡ßç‡¶ü', description: '‡¶è‡¶ï‡ßç‡¶∏‡¶™‡¶ø ‡¶Ö‡¶∞‡ßç‡¶ú‡¶® ‡ßß‡ß¶% ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', basePrice: 1000, priceMultiplier: 1.8, maxLevel: 5, type: 'profile', effect: (level) => { /* gameState.xpMultiplier = 1 + level * 0.1 */ }}, // ‡¶è‡¶á ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ Íµ¨ÌòÑ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá

        // ‡¶ï‡¶∏‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï (‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£)
        { id: 'tapButtonSkin1', name: 'üé® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ï‡¶ø‡¶® ‡ßß', description: '‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶®‡•§', basePrice: 2000, priceMultiplier: 1, maxLevel: 1, type: 'cosmetic', effect: (level) => { if(level>0) tapButton.style.backgroundImage = 'radial-gradient(circle, #ffeb3b 0%, #ff9800 100%)';} },
    ];

    function getUpgradePrice(upgrade) {
        const level = gameState.shopItems[upgrade.id] ? gameState.shopItems[upgrade.id].level : 0;
        if (upgrade.maxLevel && level >= upgrade.maxLevel) return Infinity; // ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá ‡¶™‡ßå‡¶Å‡¶õ‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶Ü‡¶∞ ‡¶ï‡ßá‡¶®‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
        return Math.floor(upgrade.basePrice * Math.pow(upgrade.priceMultiplier, level));
    }

    function renderShopItems() {
        if (!shopItemsContainer) return;
        shopItemsContainer.innerHTML = '';
        SHOP_UPGRADES.forEach(upgrade => {
            if (upgrade.condition && !upgrade.condition()) return; // ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ

            const currentLevel = gameState.shopItems[upgrade.id] ? gameState.shopItems[upgrade.id].level : 0;
            const price = getUpgradePrice(upgrade);

            const itemDiv = document.createElement('div');
            itemDiv.classList.add('shop-item', 'card');
            
            let levelText = `(‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ${currentLevel}${upgrade.maxLevel ? '/' + upgrade.maxLevel : ''})`;
            if (upgrade.maxLevel && currentLevel >= upgrade.maxLevel) levelText = '(‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶≤‡ßá‡¶≠‡ßá‡¶≤)';

            const infoDiv = document.createElement('div');
            infoDiv.classList.add('shop-item-info');
            infoDiv.innerHTML = `
                <h3>${upgrade.name} ${levelText}</h3>
                <p>${upgrade.description}</p>
                ${(upgrade.maxLevel && currentLevel >= upgrade.maxLevel) ? '<p style="color:var(--success-color);">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶°!</p>' : `<p>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤: ${formatNumber(price)} ‡¶ï‡ßü‡ßá‡¶®</p>`}
            `;

            const buyButton = document.createElement('button');
            buyButton.classList.add('button');
            buyButton.textContent = (upgrade.maxLevel && currentLevel >= upgrade.maxLevel) ? '‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá' : '‡¶ï‡¶ø‡¶®‡ßÅ‡¶®';
            if (gameState.coins < price || (upgrade.maxLevel && currentLevel >= upgrade.maxLevel)) {
                buyButton.disabled = true;
            }
            buyButton.onclick = () => buyUpgrade(upgrade.id);

            itemDiv.appendChild(infoDiv);
            itemDiv.appendChild(buyButton);
            shopItemsContainer.appendChild(itemDiv);
        });
    }

    function buyUpgrade(upgradeId) {
        const upgrade = SHOP_UPGRADES.find(u => u.id === upgradeId);
        if (!upgrade) return;

        const currentLevel = gameState.shopItems[upgrade.id] ? gameState.shopItems[upgrade.id].level : 0;
        if (upgrade.maxLevel && currentLevel >= upgrade.maxLevel) {
            showTemporaryAlert("‡¶è‡¶á ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá!", "warning");
            return;
        }

        const price = getUpgradePrice(upgrade);
        if (gameState.coins >= price) {
            gameState.coins -= price;
            if (!gameState.shopItems[upgrade.id]) gameState.shopItems[upgrade.id] = { level: 0, purchased: 0 };
            
            gameState.shopItems[upgrade.id].level++;
            gameState.shopItems[upgrade.id].purchased++; // ‡¶Æ‡ßã‡¶ü ‡¶ï‡¶§‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
            
            if(upgrade.effect) upgrade.effect(gameState.shopItems[upgrade.id].level);
            
            playSound('upgrade');
            updateAllUI();
            saveGame();
            checkAllTasksCompletion();
            showTemporaryAlert(`${upgrade.name} ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶∏‡¶´‡¶≤!`, 'success');
        } else {
            showTemporaryAlert('‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶ï‡ßü‡ßá‡¶®!', 'danger');
        }
    }
    refreshShopButton.addEventListener('click', () => {
        showTemporaryAlert('‡¶∂‡¶™ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! (‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...)', 'info');
        renderShopItems();
    });


    // --- ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡ßã‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    saveUsernameButton.addEventListener('click', () => {
        const newName = usernameInput.value.trim().slice(0, 15); // ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö ‡ßß‡ß´ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞
        if (newName) {
            gameState.username = newName;
            updateProfileInfo(); saveGame(); usernameInput.value = '';
            showTemporaryAlert('‡¶®‡¶æ‡¶Æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
        } else { showTemporaryAlert('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§', 'warning');}
    });
    themeToggleButton.addEventListener('click', () => {
        gameState.theme = (gameState.theme === 'dark' ? 'light' : 'dark');
        applyTheme(gameState.theme); saveGame();
    });
    function applyTheme(themeName) { document.body.dataset.theme = themeName; }

    resetProgressButton.addEventListener('click', () => {
        if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶∏‡¶¨ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø‡¶ì ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§')) {
            localStorage.removeItem('tapProGameData');
            localStorage.removeItem('tapGameLeaderboard'); // ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°‡¶ì ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
            // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            gameState = getInitialGameState(); // ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶™‡¶æ‡¶®
            SHOP_UPGRADES.forEach(upgrade => {
                 if(upgrade.effect) upgrade.effect(0); // Reset effect to level 0
            });
            updateAllUI(); saveGame();
            showTemporaryAlert('‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!', 'success');
            switchScreen('tapZoneScreen');
        }
    });
    function getInitialGameState() { // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        return {
            coins: 0, tapPower: 1, autoTapPower: 0, username: '‡¶Ö‡¶§‡¶ø‡¶•‡¶ø', highScore: 0,
            todayTaps: 0, totalTaps: 0, lastPlayedDate: new Date().toISOString().slice(0,10),
            level: 1, xp: 0, theme: 'dark', soundEnabled: true, shopItems: {}, completedTasks: [], activeDailyTasks: {},
            tapCombo: 0, maxCombo: 0, criticalTapChance: 0.05, criticalTapMultiplier: 3, baseTapMultiplier: 1,
            comboTimeoutId: null, lastTapTime: 0, comboThreshold: 10, comboBreakGracePeriod: 2000,
            timeBonus: { active: false, endsAt: 0, duration: 30000, nextAvailableAt: 0, cooldown: 5 * 60 * 1000, multiplierEffect: 2 },
            energy: { current: 100, max: 100, rechargeRate: 1, lastRechargeTime: Date.now(), enabled: false },
            powerMode: { active: false, endsAt: 0, duration: 10000, cooldown: 60 * 1000, nextAvailableAt: 0, effectMultiplier: 3 },
            loginStreak: 1, lastLoginDate: new Date().toISOString().slice(0,10), gameStats: { totalGameTime: 0, tapSessions: 0, avgTapsPerSecond: 0 },
            eventData: { dailyLoginClaimedToday: false, wheelSpinsToday: 0, maxWheelSpinsPerDay: 1 },
            currentLocalLeaderboard: [],
        };
    }
        
    function addXP(amount) {
        // gameState.xpMultiplier ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá
        // const finalXP = amount * (gameState.xpMultiplier || 1);
        gameState.xp += Math.floor(amount);
        checkLevelUp();
    }
    function checkLevelUp() {
        const currentLevelXPThreshold = LEVEL_XP_THRESHOLD[gameState.level -1]; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ XP (‡¶Ü‡¶∏‡¶≤‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤‡ßá‡¶∞ ‡¶•‡ßç‡¶∞‡ßá‡¶∂‡¶π‡ßã‡¶≤‡ßç‡¶°)
        const nextLevelXPThreshold = LEVEL_XP_THRESHOLD[gameState.level];

        if (nextLevelXPThreshold && gameState.xp >= nextLevelXPThreshold) {
            gameState.level++;
            // gameState.xp -= nextLevelXPThreshold; // XP ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡¶æ‡ßü
            playSound('levelUp');
            showTemporaryAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ${gameState.level}-‡¶è ‡¶™‡ßå‡¶Å‡¶õ‡ßá‡¶õ‡ßá‡¶®!`, 'success');
            const bonusCoins = gameState.level * 100 * gameState.level; // ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶¨‡¶æ‡ßú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡¶ì ‡¶¨‡ßá‡¶∂‡¶ø
            gameState.coins += bonusCoins;
            showTemporaryAlert(`‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶Ü‡¶™ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏: +${formatNumber(bonusCoins)} ‡¶ï‡ßü‡ßá‡¶®!`, 'success');
            
            // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, ‡¶Ø‡ßá‡¶Æ‡¶® ‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ß´ ‡¶è
            if (gameState.level === 5 && !gameState.energy.enabled) {
                // gameState.energy.enabled = true; // ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶™ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶π‡¶¨‡ßá
                // showTemporaryAlert("‡¶è‡¶®‡¶æ‡¶∞‡ßç‡¶ú‡¶ø ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶®‡¶≤‡¶ï‡¶°! ‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "info");
            }

            updateProfileInfo(); saveGame();
            checkLevelUp(); // ‡¶Ø‡¶¶‡¶ø ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡¶Ü‡¶™ ‡¶π‡ßü
        }
        updateProfileInfo(); // XP ‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
    }

    const BADGES_DEFINITIONS = [
        { id: 'beginner_tapper', name: '‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶®‡¶¨‡¶ø‡¶∂', emoji: 'üî∞', condition: () => gameState.totalTaps >= 100 },
        { id: 'master_tapper', name: '‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞', emoji: '·Éù·É°', condition: () => gameState.totalTaps >= 5000 },
        { id: 'coin_collector', name: '‡¶ï‡ßü‡ßá‡¶® ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï', emoji: 'üí∞', condition: () => gameState.coins >= 50000 },
        { id: 'level_10', name: '‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ßß‡ß¶', emoji: 'üîü', condition: () => gameState.level >= 10 },
        { id: 'combo_king', name: '‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶ï‡¶ø‡¶Ç', emoji: 'üëë', condition: () => gameState.maxCombo >= 50 },
        { id: 'shopaholic', name: '‡¶∂‡¶™‡¶π‡ßã‡¶≤‡¶ø‡¶ï', emoji: 'üõçÔ∏è', condition: () => Object.values(gameState.shopItems).reduce((sum, item) => sum + item.purchased, 0) >= 10 }, // ‡¶Æ‡ßã‡¶ü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶ï‡ßá‡¶®‡¶æ‡¶ï‡¶æ‡¶ü‡¶æ
        { id: 'daily_player', name: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ñ‡ßá‡¶≤‡ßã‡ßü‡¶æ‡ßú', emoji: 'üìÖ', condition: () => gameState.loginStreak >= 7 },
    ];
    function renderBadges() {
        badgesContainerEl.innerHTML = '';
        const userBadges = BADGES_DEFINITIONS.filter(badge => badge.condition());
        if (userBadges.length === 0) {
            badgesContainerEl.innerHTML = '<p style="font-size:12px; color:#aaa; text-align:center; margin:0;">‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶®‡ßá‡¶á‡•§</p>';
            return;
        }
        userBadges.forEach(badge => {
            const badgeEl = document.createElement('span');
            badgeEl.textContent = badge.emoji;
            badgeEl.title = badge.name;
            badgeEl.style.fontSize = '24px';
            badgesContainerEl.appendChild(badgeEl);
        });
    }


    // --- ‡¶ó‡ßá‡¶Æ ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ú‡ßã‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    const TASKS = [
        // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï (‡¶è‡¶ï‡¶¨‡¶æ‡¶∞)
        { id: 'tap100', name: '‡ßß‡ß¶‡ß¶ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®', description: '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ú‡ßã‡¶®‡ßá ‡ßß‡ß¶‡ß¶ ‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 100, xp: 20 }, condition: () => gameState.totalTaps >= 100, type: 'onetime' },
        { id: 'buyUpgrade1', name: '‡ßß‡¶ü‡¶ø ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®', description: '‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡ßß‡¶ü‡¶ø ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®‡•§', reward: { coins: 200, xp: 50 }, condition: () => Object.values(gameState.shopItems).some(item => item.level > 0), type: 'onetime' },
        { id: 'reachLevel5', name: '‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ß´-‡¶è ‡¶™‡ßå‡¶Å‡¶õ‡¶æ‡¶®', description: '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ‡ß´ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 500, xp: 100 }, condition: () => gameState.level >= 5, type: 'onetime' },
        { id: 'combo25', name: '‡ß®‡ß´ ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶π‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®', description: '‡¶ü‡¶æ‡¶®‡¶æ ‡ß®‡ß´‡¶ü‡¶ø ‡¶ï‡¶Æ‡ßç‡¶¨‡ßã ‡¶π‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 300, xp: 75 }, condition: () => gameState.maxCombo >= 25, type: 'onetime' },
        { id: 'save10kCoins', name: '‡ßß‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ï‡ßü‡ßá‡¶® ‡¶ú‡¶Æ‡¶æ‡¶®', description: '‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡ßß‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ï‡ßü‡ßá‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§', reward: { coins: 1000, xp: 150 }, condition: () => gameState.coins >= 10000, type: 'onetime'},
        
        // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
        { id: 'tap500daily', name: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡ß´‡ß¶‡ß¶ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™', description: '‡¶Ü‡¶ú‡¶ï‡ßá ‡ß´‡ß¶‡ß¶ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 250, xp: 60 }, condition: () => gameState.todayTaps >= 500, type: 'daily' },
        { id: 'complete3tasksDaily', name: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡ß©‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', description: '‡¶Ü‡¶ú‡¶ï‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡ß©‡¶ü‡¶ø ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 400, xp: 100 }, condition: () => countDailyCompletedTasks() >= 3, type: 'daily'}, // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá

        // ‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï (‡¶∏‡¶∞‡¶≤‡ßÄ‡¶ï‡ßÉ‡¶§, ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶π‡¶¨‡ßá ‡¶§‡¶¨‡ßá ‡¶¨‡ßú ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø)
        // { id: 'tap10000weekly', name: '‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡ßß‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™', description: '‡¶è‡¶á ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá ‡ßß‡ß¶,‡ß¶‡ß¶‡ß¶ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', reward: { coins: 2000, xp: 500 }, condition: () => gameState.totalTaps % 10000 < 1000, type: 'weekly' }, // ‡¶∏‡¶ø‡¶Æ‡ßç‡¶™‡¶≤ ‡¶ï‡¶®‡ßç‡¶°‡¶ø‡¶∂‡¶®
    ];
    
    function countDailyCompletedTasks() {
        let count = 0;
        TASKS.forEach(task => {
            if (task.type === 'daily' && gameState.activeDailyTasks[task.id] && gameState.activeDailyTasks[task.id].completedToday) {
                count++;
            }
        });
        // ‡¶è‡¶ï‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶ì ‡¶ó‡ßã‡¶®‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        gameState.completedTasks.forEach(taskId => {
            const taskInfo = TASKS.find(t => t.id === taskId);
            // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá‡¶á ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá (‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø completion date ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá)
            // ‡¶Ü‡¶™‡¶æ‡¶§‡¶§ ‡¶∏‡¶∞‡¶≤ ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶æ ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡¶ø
        });
        return count;
    }


    function renderTasks() {
        if (!tasksContainer) return;
        tasksContainer.innerHTML = '';
        TASKS.forEach(task => {
            let isCompleted = false;
            let canClaim = false;

            if (task.type === 'onetime') {
                isCompleted = gameState.completedTasks.includes(task.id);
                if (!isCompleted && task.condition()) canClaim = true;
            } else if (task.type === 'daily') {
                if (!gameState.activeDailyTasks[task.id]) { // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
                    gameState.activeDailyTasks[task.id] = { completedToday: false, lastCompletionDate: '' };
                }
                isCompleted = gameState.activeDailyTasks[task.id].completedToday;
                if (!isCompleted && task.condition()) canClaim = true;
            }
            // ‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï/‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶á ‡¶∞‡¶ï‡¶Æ ‡¶≤‡¶ú‡¶ø‡¶ï

            const taskDiv = document.createElement('div');
            taskDiv.classList.add('task-item', 'card');
            if (isCompleted) taskDiv.classList.add('completed');

            let progressTextContent = '';
            if (!isCompleted && !canClaim) { // ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶®‡¶æ ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç ‡¶¶‡¶æ‡¶¨‡¶ø‡¶ì ‡¶ï‡¶∞‡¶æ ‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü, ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                if (task.id === 'tap100') progressTextContent = `‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø: ${gameState.totalTaps}/100`;
                else if (task.id === 'tap500daily') progressTextContent = `‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø: ${gameState.todayTaps}/500`;
                else if (task.id === 'combo25') progressTextContent = `‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø: ${gameState.maxCombo}/25`;
                // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø...
            }
            
            taskDiv.innerHTML = `
                <h3>${task.name} ${isCompleted ? '(‡¶Ü‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®)' : (task.type === 'onetime' && gameState.completedTasks.includes(task.id) ? '(‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®)' : '')}</h3>
                <p>${task.description}</p>
                <p>üéÅ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞: ${formatNumber(task.reward.coins)} ‡¶ï‡ßü‡ßá‡¶®, ${task.reward.xp} XP</p>
                ${progressTextContent ? `<p style="font-size:0.8em; color:var(--warning-color);">${progressTextContent}</p>` : ''}
            `;
            
            if (canClaim) {
                const claimButton = document.createElement('button');
                claimButton.classList.add('button');
                claimButton.textContent = '‡¶¶‡¶æ‡¶¨‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®';
                claimButton.style.padding = "8px 12px"; claimButton.style.fontSize = "12px";
                claimButton.onclick = () => completeTask(task.id);
                taskDiv.appendChild(claimButton);
            }
            tasksContainer.appendChild(taskDiv);
        });
        renderTaskHistory();
    }

    function completeTask(taskId) {
        const task = TASKS.find(t => t.id === taskId);
        if (!task) return;

        let alreadyClaimed = false;
        if (task.type === 'onetime') {
            alreadyClaimed = gameState.completedTasks.includes(taskId);
        } else if (task.type === 'daily') {
            alreadyClaimed = gameState.activeDailyTasks[taskId] && gameState.activeDailyTasks[taskId].completedToday;
        }

        if (alreadyClaimed) {
            showTemporaryAlert("‡¶è‡¶á ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§", "warning");
            return;
        }

        if (task.condition()) {
            gameState.coins += task.reward.coins;
            addXP(task.reward.xp);
            
            if (task.type === 'onetime') {
                gameState.completedTasks.push(taskId);
            } else if (task.type === 'daily') {
                if(!gameState.activeDailyTasks[task.id]) gameState.activeDailyTasks[task.id] = {};
                gameState.activeDailyTasks[task.id].completedToday = true;
                gameState.activeDailyTasks[task.id].lastCompletionDate = new Date().toISOString().slice(0,10);
            }
            
            playSound('taskComplete'); showConfetti();
            showTemporaryAlert(`"${task.name}" ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! +${formatNumber(task.reward.coins)}üí∞, +${task.reward.xp}XP ‚ú®`, 'success', 4000);
            updateAllUI(); saveGame();
            checkAllTasksCompletion(); // ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶≤‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® "‡ß©‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®")
        } else {
            showTemporaryAlert("‡¶Æ‡¶ø‡¶∂‡¶®‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶è‡¶ñ‡¶®‡ßã ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡¶®‡¶ø‡•§", "warning");
        }
    }
    function checkAllTasksCompletion() { // ‡¶ï‡ßã‡¶®‡ßã UI ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ‡ßá‡¶¨‡¶≤ ‡¶ï‡¶ø‡¶®‡¶æ ‡¶§‡¶æ ‡¶∞‡¶ø-‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá
        if (document.getElementById('taskZoneScreen').classList.contains('active')) {
            renderTasks();
        }
    }
    function renderTaskHistory() {
        taskHistoryListEl.innerHTML = '';
        let completedCount = 0;
        TASKS.forEach(task => { // ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≤‡ßÅ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®
            let taskName = task.name;
            let completedDate = '';

            if (task.type === 'onetime' && gameState.completedTasks.includes(task.id)) {
                 // ‡¶è‡¶ï‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø, ‡¶§‡¶æ‡¶á ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶æ‡¶Æ
                 const li = document.createElement('li');
                 li.textContent = `${taskName} - ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® (‡¶è‡¶ï‡¶¨‡¶æ‡¶∞)`;
                 taskHistoryListEl.appendChild(li);
                 completedCount++;
            } else if (task.type === 'daily' && gameState.activeDailyTasks[task.id] && gameState.activeDailyTasks[task.id].lastCompletionDate) {
                 // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§‡¶ø‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
                 const li = document.createElement('li');
                 li.textContent = `${taskName} - ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ${new Date(gameState.activeDailyTasks[task.id].lastCompletionDate).toLocaleDateString('bn-BD')}`;
                 taskHistoryListEl.appendChild(li);
                 // completedCount++; // ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡ßá ‡¶ï‡¶§‡¶¨‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ‡¶§‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞
            }
        });

        if (taskHistoryListEl.children.length === 0) { // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
             taskHistoryListEl.innerHTML = '<li>‡¶ï‡ßã‡¶®‡ßã ‡¶Æ‡¶ø‡¶∂‡¶® ‡¶è‡¶ñ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡¶®‡¶ø‡•§</li>';
        }
    }
    function showConfetti() { /* ... ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ... */ }


    // --- ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶ú‡ßã‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    function getLocalLeaderboard(category = 'score') {
        let leaderboard = JSON.parse(localStorage.getItem('tapGameLeaderboard')) || [];
        
        // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶§‡ßà‡¶∞‡¶ø
        let userScore;
        switch(category) {
            case 'level': userScore = gameState.level; break;
            case 'totalTaps': userScore = gameState.totalTaps; break;
            default: userScore = gameState.highScore; // score
        }
        const userEntry = { name: gameState.username, score: userScore, level: gameState.level, isUser: true };

        let userInLeaderboard = false;
        leaderboard = leaderboard.map(entry => {
            if (entry.name === gameState.username) { // ‡¶è‡¶ï‡¶á ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                userInLeaderboard = true;
                return { ...entry, ...userEntry }; // ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶ì ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            }
            return entry;
        });

        if (!userInLeaderboard) {
            leaderboard.push(userEntry);
        }
        
        // ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶è‡¶®‡ßç‡¶ü‡ßç‡¶∞‡¶ø (‡¶Ø‡¶¶‡¶ø ‡¶ï‡¶Æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá)
        const dummyNames = ["‡¶ñ‡ßá‡¶≤‡ßã‡¶Ø‡¶º‡¶æ‡¶°‡¶º ‡ßß", "‡¶ó‡ßá‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã", "‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶ø‡¶Ç", "‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞", "‡¶Ü‡¶≤‡¶´‡¶æ ‡¶ü‡ßá‡¶™‡¶æ‡¶∞", "‡¶¨‡ßá‡¶ü‡¶æ ‡¶ü‡ßá‡¶∏‡ßç‡¶ü‡¶æ‡¶∞", "‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶ü‡ßá‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï", "‡¶≤‡ßá‡¶ú‡ßá‡¶®‡ßç‡¶°"];
        let currentDummyCount = leaderboard.filter(e => !e.isUser).length;

        for (let i = 0; i < dummyNames.length && currentDummyCount < 7; i++) {
            const name = dummyNames[i % dummyNames.length] + (Math.floor(i/dummyNames.length) > 0 ? ` ${Math.floor(i/dummyNames.length)+1}` : '');
            if (!leaderboard.some(entry => entry.name === name)) {
                let dummyScore, dummyLevel, dummyTotalTaps;
                dummyLevel = Math.max(1, Math.floor(Math.random() * (gameState.level + 5) + (gameState.level / 2) -2));
                dummyTotalTaps = Math.max(10, Math.floor(Math.random() * (gameState.totalTaps + 1000) + (gameState.totalTaps / 2) - 500));
                dummyScore = Math.max(100, Math.floor(Math.random() * (gameState.highScore + 20000) + (gameState.highScore / 2) - 10000));
                
                let displayScore;
                switch(category) {
                    case 'level': displayScore = dummyLevel; break;
                    case 'totalTaps': displayScore = dummyTotalTaps; break;
                    default: displayScore = dummyScore;
                }

                leaderboard.push({ name: name, score: displayScore, level: dummyLevel });
                currentDummyCount++;
            }
        }

        leaderboard.sort((a, b) => b.score - a.score); // ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
        leaderboard = leaderboard.slice(0, 10); // ‡¶∏‡ßá‡¶∞‡¶æ ‡ßß‡ß¶ ‡¶ú‡¶®

        // isUser ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ó ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡ßá‡¶≠ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡¶á ‡¶≠‡¶æ‡¶≤‡ßã
        gameState.currentLocalLeaderboard = leaderboard.map(e => ({...e, isUser: e.name === gameState.username})); // isUser ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        localStorage.setItem('tapGameLeaderboard', JSON.stringify(leaderboard.map(e => ({name: e.name, score: e.score, level: e.level}))));
        return gameState.currentLocalLeaderboard;
    }

    function renderRankings() {
        if (!rankingListContainer || !rankingCategorySelect) return;
        const category = rankingCategorySelect.value;
        rankingListContainer.innerHTML = '‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
        
        setTimeout(() => { // ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶°‡¶ø‡¶≤‡ßá ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶ü‡¶æ‡¶á‡¶Æ
            const leaderboard = getLocalLeaderboard(category);
            rankingListContainer.innerHTML = ''; // ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®

            if (leaderboard.length === 0) {
                rankingListContainer.innerHTML = '<p>‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á‡•§</p>';
                return;
            }

            leaderboard.forEach((entry, index) => {
                const rankItem = document.createElement('div');
                rankItem.classList.add('rank-item', 'card'); // card class ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                if (entry.isUser) {
                    rankItem.classList.add('user-rank');
                }
                // ‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° (‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£)
                if (index === 0 && !entry.isUser) rankItem.style.borderLeftColor = 'gold';
                else if (index === 1 && !entry.isUser) rankItem.style.borderLeftColor = 'silver';
                else if (index === 2 && !entry.isUser) rankItem.style.borderLeftColor = '#cd7f32'; /* Bronze */


                let scoreLabel = "‡¶∏‡ßç‡¶ï‡ßã‡¶∞";
                if (category === 'level') scoreLabel = "‡¶≤‡ßá‡¶≠‡ßá‡¶≤";
                else if (category === 'totalTaps') scoreLabel = "‡¶Æ‡ßã‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™";

                rankItem.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span class="rank-position" style="font-size: 1.5em; min-width:40px;">${index + 1}.</span>
                        <span class="rank-name" style="flex-grow:1; margin-left:10px;">${entry.name} ${entry.isUser ? "(‡¶Ü‡¶™‡¶®‡¶ø)" : ""} (‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ${entry.level || 1})</span>
                        <span class="rank-score" style="font-weight:bold; font-size:1.1em;">${formatNumber(entry.score)} ${category === 'score' ? '' : ''}</span>
                    </div>
                `;
                rankingListContainer.appendChild(rankItem);
            });
        }, 200); // ‡ß®‡ß¶‡ß¶ms ‡¶°‡¶ø‡¶≤‡ßá
    }
    rankingCategorySelect.addEventListener('change', renderRankings);
    updateRankButton.addEventListener('click', () => {
        showTemporaryAlert('‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡¶ø‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info', 1000);
        renderRankings();
    });

    // --- ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡ßã‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    const EVENTS = [
        { 
            id: 'dailyLogin', name: 'üéÅ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏', 
            description: `‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ${formatNumber(500 + gameState.loginStreak * 100)} ‡¶ï‡ßü‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ${20 + gameState.loginStreak * 5} XP ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï: ${gameState.loginStreak} ‡¶¶‡¶ø‡¶®‡•§`,
            actionText: '‡¶¶‡¶æ‡¶¨‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®',
            canClaim: () => !gameState.eventData.dailyLoginClaimedToday,
            onClaim: () => {
                const coinReward = 500 + gameState.loginStreak * 100;
                const xpReward = 20 + gameState.loginStreak * 5;
                gameState.coins += coinReward;
                addXP(xpReward);
                gameState.eventData.dailyLoginClaimedToday = true;
                showTemporaryAlert(`‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏! +${formatNumber(coinReward)}üí∞, +${xpReward}XP ‚ú®`, 'success');
            }
        },
        {
            id: 'timeBonusEvent', name: '‚è±Ô∏è ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶ü',
            description: `‡¶è‡¶ñ‡¶®‡¶á ${gameState.timeBonus.duration/1000} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Æ‡¶æ‡¶≤‡ßç‡¶ü‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡ßü‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶ø‡¶ó‡ßÅ‡¶£ (${gameState.timeBonus.multiplierEffect}x) ‡¶ï‡¶∞‡ßÅ‡¶®!`,
            actionText: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶ü',
            canClaim: () => !gameState.timeBonus.active && Date.now() >= gameState.timeBonus.nextAvailableAt,
            onClaim: () => { activateTimeBonus(); }
        },
        {
            id: 'wheelOfFortune', name: 'üé° ‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø‡¶ö‡¶ï‡ßç‡¶∞',
            description: `‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø‡¶ö‡¶ï‡ßç‡¶∞ ‡¶ò‡ßÅ‡¶∞‡¶ø‡ßü‡ßá ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡ßü ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®! ‡¶¶‡¶ø‡¶®‡ßá ${gameState.eventData.maxWheelSpinsPerDay} ‡¶¨‡¶æ‡¶∞‡•§ (‡¶Ü‡¶ú‡¶ï‡ßá ${gameState.eventData.wheelSpinsToday} ‡¶¨‡¶æ‡¶∞ ‡¶ò‡ßã‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá)`,
            actionText: '‡¶ò‡ßã‡¶∞‡¶æ‡¶®',
            canClaim: () => gameState.eventData.wheelSpinsToday < gameState.eventData.maxWheelSpinsPerDay,
            onClaim: () => {
                gameState.eventData.wheelSpinsToday++;
                const prizes = [
                    {type: 'coins', value: 1000, weight: 40}, {type: 'coins', value: 5000, weight: 20},
                    {type: 'xp', value: 50, weight: 30}, {type: 'xp', value: 200, weight: 10},
                    {type: 'nothing', value: 0, weight: 5} // ‡¶ï‡¶ø‡¶ö‡ßç‡¶õ‡ßÅ ‡¶®‡¶æ
                ];
                const totalWeight = prizes.reduce((sum, p) => sum + p.weight, 0);
                let randomNum = Math.random() * totalWeight;
                let chosenPrize;
                for (const prize of prizes) {
                    if (randomNum < prize.weight) { chosenPrize = prize; break; }
                    randomNum -= prize.weight;
                }
                if (chosenPrize && chosenPrize.type !== 'nothing') {
                    if (chosenPrize.type === 'coins') gameState.coins += chosenPrize.value;
                    if (chosenPrize.type === 'xp') addXP(chosenPrize.value);
                    showTemporaryAlert(`‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø‡¶ö‡¶ï‡ßç‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ${formatNumber(chosenPrize.value)} ${chosenPrize.type === 'coins' ? '‡¶ï‡ßü‡ßá‡¶®' : 'XP'} ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®!`, 'success');
                } else {
                    showTemporaryAlert('‡¶â‡¶´‡¶´! ‡¶è‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡¶æ‡¶®‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®!', 'warning');
                }
            }
        },
        // ‡¶Ü‡¶∞‡¶ì ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
    ];

    function renderEvents() {
        if (!eventItemsContainer) return;
        eventItemsContainer.innerHTML = '';
        EVENTS.forEach(event => {
            const eventDiv = document.createElement('div');
            eventDiv.classList.add('event-item', 'card');
            
            // Description ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶¶‡¶ø ‡¶§‡¶æ gameState ‡¶è‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞‡¶∂‡ßÄ‡¶≤ ‡¶π‡ßü
            let description = event.description;
            if(event.id === 'dailyLogin') description = `‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ${formatNumber(500 + gameState.loginStreak * 100)} ‡¶ï‡ßü‡ßá‡¶® ‡¶è‡¶¨‡¶Ç ${20 + gameState.loginStreak * 5} XP ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï: ${gameState.loginStreak} ‡¶¶‡¶ø‡¶®‡•§`;
            if(event.id === 'wheelOfFortune') description = `‡¶≠‡¶æ‡¶ó‡ßç‡¶Ø‡¶ö‡¶ï‡ßç‡¶∞ ‡¶ò‡ßÅ‡¶∞‡¶ø‡ßü‡ßá ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡ßü ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ú‡¶ø‡¶§‡ßÅ‡¶®! ‡¶¶‡¶ø‡¶®‡ßá ${gameState.eventData.maxWheelSpinsPerDay} ‡¶¨‡¶æ‡¶∞‡•§ (‡¶Ü‡¶ú‡¶ï‡ßá ${gameState.eventData.wheelSpinsToday}/${gameState.eventData.maxWheelSpinsPerDay} ‡¶¨‡¶æ‡¶∞ ‡¶ò‡ßã‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá)`;


            eventDiv.innerHTML = `
                <h3>${event.name}</h3>
                <p>${description}</p>
            `;
            
            const canClaim = event.canClaim();
            if (canClaim || !event.canClaim()) { // ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ disable ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
                const claimButton = document.createElement('button');
                claimButton.classList.add('button');
                claimButton.textContent = event.actionText;
                claimButton.disabled = !canClaim;
                
                let cooldownText = "";
                if (event.id === 'timeBonusEvent' && !canClaim && Date.now() < gameState.timeBonus.nextAvailableAt) {
                    cooldownText = ` (${Math.ceil((gameState.timeBonus.nextAvailableAt - Date.now())/1000)}s ‡¶¨‡¶æ‡¶ï‡¶ø)`;
                    claimButton.textContent += cooldownText;
                }

                claimButton.onclick = () => {
                    if (event.canClaim()) {
                        event.onClaim();
                        updateAllUI(); // UI ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
                        saveGame();
                    }
                };
                eventDiv.appendChild(claimButton);
            }
            eventItemsContainer.appendChild(eventDiv);
        });
    }


    // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ---
    function showTemporaryAlert(message, type = 'info', duration = 3000) {
        alertPopup.textContent = message;
        alertPopup.className = 'alert-popup'; // Reset classes
        
        if (type === 'success') alertPopup.style.backgroundColor = 'var(--success-color)';
        else if (type === 'warning') alertPopup.style.backgroundColor = 'var(--warning-color)';
        else if (type === 'danger') alertPopup.style.backgroundColor = 'var(--danger-color)';
        else alertPopup.style.backgroundColor = 'var(--accent-color)';
        alertPopup.style.color = (type === 'warning' ? 'var(--primary-color)' : '#fff'); // ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü

        alertPopup.classList.add('show');
        setTimeout(() => {
            alertPopup.classList.remove('show');
        }, duration);
    }

    // --- ‡¶ó‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ---
    function initGame() {
        console.log("‡¶ó‡ßá‡¶Æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        loadSounds();
        gameState = getInitialGameState(); // ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá
        loadGame(); // ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ì‡¶≠‡¶æ‡¶∞‡¶∞‡¶æ‡¶á‡¶° (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)
        
        // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶ó‡ßá‡¶Æ ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ü‡¶ø‡¶™‡¶∏ ‡¶¨‡¶æ ‡¶ì‡ßü‡ßá‡¶≤‡¶ï‡¶æ‡¶Æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        if(gameState.totalTaps === 0 && gameState.coins === 0) {
            showTemporaryAlert("‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ü‡ßÅ ‡¶Ü‡¶∞‡ßç‡¶® ‡¶™‡ßç‡¶∞‡ßã-‡¶§‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßá ‡¶ï‡ßü‡ßá‡¶® ‡¶ú‡¶Æ‡¶æ‡¶® ‡¶ì ‡¶Ü‡¶™‡¶ó‡ßç‡¶∞‡ßá‡¶° ‡¶ï‡¶ø‡¶®‡ßÅ‡¶®‡•§", "info", 5000);
        }
        
        switchScreen('tapZoneScreen'); // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®
        updateAllUI(); // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ UI ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        checkAllTasksCompletion();
        renderEvents(); // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
        console.log("‡¶ó‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§!");
    }

    document.addEventListener('DOMContentLoaded', initGame);

    </script>
</body>
</html>